#!/bin/sh

# xstart 0.1
# Let's user choose which type of X session to start.
# By: Devon Bautista

# Display help if -h or --help option used.
if [ "$1" = --help -o "$1" = -h ]; then
	echo "Usage: xstart [OPTION]"
	echo "Choose which X session to start based on OPTION."
	echo
	echo OPTIONS:
	echo "-i, --i3		Execute i3 when starting X."
	echo "-k, --kde		Execute KDE when starting X."
	echo
	echo SUBOPTIONS:
	echo "-l, --logs 		Use logs when executing."
	echo
	echo "Executing command without parameters will start X"
	echo "using the standard .xinitrc file."
# Start X with i3 if -i or --i3 option  used.
elif [ "$1" = -i -o "$1" = --i3 ]; then
	shift
	if [ "$1" = -l -o "$1" = --log ]; then
		echo "Editing .xinitrc file..."
		sed 's:^#exec i3 -V >> ~/i3log-\$(date +"%F-%k-%M-%S") 2>&1:exec i3 -V >> ~/i3log-$(date +"%F-%k-%M-%S") 2>\&1:' .xinitrc |
		sed 's/^exec dbus-launch i3/#exec dbus-launch i3/' |
		sed 's:^exec startkde >> ~/kdelog-\$(date +"%F-%k-%M-%S") 2>&1:#&:' |
		sed 's/^exec startkde/#exec startkde/' > .xinitrc.TMP
		mv .xinitrc.TMP .xinitrc
		echo "Starting X: i3 with logs..."
		startx
	elif [ -z "$1" ]; then
		echo "Editing .xinitrc file..."
		sed 's:^exec i3 -V >> ~/i3log-\$(date +"%F-%k-%M-%S") 2>&1:#&:' .xinitrc |
		sed 's/^#exec dbus-launch i3$/exec dbus-launch i3/' |
		sed 's:^exec startkde >> ~/kdelog-\$(date +"%F-%k-%M-%S") 2>&1:#&:' |
		sed 's/^exec startkde$/#exec startkde/' > .xinitrc.TMP
		mv .xinitrc.TMP .xinitrc
		echo "Starting X: i3..."
		startx
	else
		echo "Unrecognized suboption \"$1\"."
		exit 1
	fi
# Start X with KDE if -k or --kde option used.
elif [ "$1" = -k -o "$1" = --kde ]; then
	shift
	if [ "$1" = -l -o "$1" = --log ]; then
		echo "Editing .xinitrc file..."
		sed 's:^exec i3 -V >> ~/i3log-\$(date +"%F-%k-%M-%S") 2>&1:#&:' .xinitrc |
		sed 's/^exec dbus-launch i3$/#exec dbus-launch i3/' |
		sed 's:^#exec startkde >> ~/kdelog-\$(date +"%F-%k-%M-%S") 2>&1:exec startkde >> ~/kdelog-$(date +"%F-%k-%M-%S") 2>\&1:' |
		sed 's/^exec startkde$/#exec startkde/' > .xinitrc.TMP
		mv .xinitrc.TMP .xinitrc
		echo "Starting X: KDE with logs..."
		startx
	elif [ -z "$1" ]; then
		echo "Editing .xinitrc file..."
		sed 's:^exec i3 -V >> ~/i3log-\$(date +"%F-%k-%M-%S") 2>&1:#&:' .xinitrc |
		sed 's/^exec dbus-launch i3$/#exec dbus-launch i3/' |
		sed 's:^exec startkde >> ~/kdelog-\$(date +"%F-%k-%M-%S") 2>&1:#&:' |
		sed 's/^#exec startkde$/exec startkde/' > .xinitrc.TMP
		mv .xinitrc.TMP .xinitrc
		echo "Starting X: KDE..."
		startx
	else
		echo "Unrecognized suboption \"$1\"."
		exit 1
	fi
elif [ -z "$1" ]; then
	echo "Starting X: No changes to .xinitrc..."
	startx
else
	echo "Usage: xstart [OPTIONS]"
	echo "Choose which X session to start based on OPTION."
	echo "\"xstart --help\" or \"xstart -h\" for a list of options."
	exit 1
fi
